Давай теперь проведём масштабное кодревью. Я буду высылать файлы по очереди. Твоя задача проверить абсолютно всё. Добавить хорошие комментарии и докстриги. Докапывайся до каждой мелочи. Код должен быть идеален. Я буду все последующие сообщения начинать с этих слов, чтобы ты не забывал контекст.