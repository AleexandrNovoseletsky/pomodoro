{
  "start_ts": "2025-11-09T11:25:51.401035Z",
  "success": true,
  "error": null,
  "error_traceback": null,
  "created_user_ids": [
    23,
    24,
    25
  ],
  "created_category_ids": [
    29,
    30
  ],
  "created_task_ids": [
    44,
    45,
    46
  ],
  "steps": [
    {
      "ts": "2025-11-09T11:25:51.401652Z",
      "ok": true,
      "message": "Подготовка пользователей в БД...",
      "details": null,
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.116382Z",
      "ok": true,
      "message": "Успешный вход всех трёх пользователей",
      "details": null,
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.173732Z",
      "ok": true,
      "message": "Вход с неверными учётными данными отклонён (ожидаемо)",
      "details": {
        "status_code": 401
      },
      "request": {
        "url": "http://127.0.0.1:8000/users/login",
        "data": {
          "username": "+70000000001",
          "password": "wrong"
        }
      },
      "response": {
        "status_code": 401,
        "text": "{\"error\":\"InvalidCredentials\",\"detail\":\"Неверный логин или пароль.\"}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.184115Z",
      "ok": true,
      "message": "Root создал категорию",
      "details": {
        "id": 29
      },
      "request": {
        "url": "http://127.0.0.1:8000/categories/",
        "json": {
          "name": "root-cat"
        }
      },
      "response": {
        "status_code": 201
      }
    },
    {
      "ts": "2025-11-09T11:25:52.191795Z",
      "ok": true,
      "message": "Admin создал категорию",
      "details": {
        "id": 30
      },
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.197874Z",
      "ok": true,
      "message": "Создание категории с уже существующим именем отклонено (ожидаемо)",
      "details": null,
      "request": {
        "url": "http://127.0.0.1:8000/categories/",
        "json": {
          "name": "root-cat",
          "is_active": true
        }
      },
      "response": {
        "status_code": 409,
        "text": "{\"error\":\"IntegrityDBError\",\"detail\":\"Объект с таким уникальным значением уже существует.\",\"db_error\":\"<class 'asyncpg.exceptions.uniqueviolationerror'>: duplicate key value violates unique constraint \\\"categories_name_key\\\"\\ndetail:  key (name)=(root-cat) already exists.\"}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.204368Z",
      "ok": true,
      "message": "Переименование категории на уже существующее имя отклонено (ожидаемо)",
      "details": null,
      "request": {
        "url": "http://127.0.0.1:8000/categories/?category_id=30",
        "json": {
          "name": "root-cat"
        }
      },
      "response": {
        "status_code": 409,
        "text": "{\"error\":\"IntegrityDBError\",\"detail\":\"Объект с таким уникальным значением уже существует.\",\"db_error\":\"<class 'asyncpg.exceptions.uniqueviolationerror'>: duplicate key value violates unique constraint \\\"categories_name_key\\\"\\ndetail:  key (name)=(root-cat) already exists.\"}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.213556Z",
      "ok": true,
      "message": "Создана задача",
      "details": {
        "phone": "+70000000001",
        "id": 44
      },
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.220142Z",
      "ok": true,
      "message": "Создана задача",
      "details": {
        "phone": "+70000000002",
        "id": 45
      },
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.226566Z",
      "ok": true,
      "message": "Создана задача",
      "details": {
        "phone": "+70000000003",
        "id": 46
      },
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.230401Z",
      "ok": true,
      "message": "Создание задачи с дублирующимся именем отклонено (ожидаемо)",
      "details": null,
      "request": {
        "url": "http://127.0.0.1:8000/tasks/",
        "json": {
          "name": "task-+70000000001",
          "pomodoro_count": 1,
          "category_id": 29,
          "is_active": true
        }
      },
      "response": {
        "status_code": 409,
        "text": "{\"error\":\"IntegrityDBError\",\"detail\":\"Объект с таким уникальным значением уже существует.\",\"db_error\":\"<class 'asyncpg.exceptions.uniqueviolationerror'>: duplicate key value violates unique constraint \\\"tasks_name_key\\\"\\ndetail:  key (name)=(task-+70000000001) already exists.\"}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.234135Z",
      "ok": true,
      "message": "GET /tasks без авторизации работает (ожидаемо)",
      "details": null,
      "request": null,
      "response": null
    },
    {
      "ts": "2025-11-09T11:25:52.234904Z",
      "ok": true,
      "message": "Создание пользователя с существующим телефоном отклонено (ожидаемо)",
      "details": null,
      "request": {
        "url": "http://127.0.0.1:8000/users/",
        "json": {
          "phone": "+70000000001",
          "first_name": "Dup",
          "last_name": "User",
          "password": "x"
        }
      },
      "response": {
        "status_code": 405,
        "text": "{\"detail\":\"Method Not Allowed\"}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.238097Z",
      "ok": true,
      "message": "Создание категории с очень длинным именем отклонено (ожидаемо)",
      "details": null,
      "request": {
        "url": "http://127.0.0.1:8000/categories/",
        "json": {
          "name_len": 1025
        }
      },
      "response": {
        "status_code": 422,
        "text": "{\"detail\":[{\"type\":\"string_too_long\",\"loc\":[\"body\",\"name\"],\"msg\":\"String should have at most 30 characters\",\"input\":\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\"ctx\":{\"max_length\":30}}]}"
      }
    },
    {
      "ts": "2025-11-09T11:25:52.238112Z",
      "ok": true,
      "message": "E2E: все проверки выполнены (частично).",
      "details": null,
      "request": null,
      "response": null
    }
  ],
  "cleanup": {
    "users": [
      {
        "id": 23,
        "deleted": true
      },
      {
        "id": 24,
        "deleted": true
      },
      {
        "id": 25,
        "deleted": true
      }
    ],
    "categories": [
      {
        "id": 29,
        "deleted": true
      },
      {
        "id": 30,
        "deleted": true
      }
    ],
    "tasks": [
      {
        "id": 44,
        "deleted": true
      },
      {
        "id": 45,
        "deleted": true
      },
      {
        "id": 46,
        "deleted": true
      }
    ]
  },
  "cleanup_human": [
    "Удалено: task id=44",
    "Удалено: task id=45",
    "Удалено: task id=46",
    "Удалено: categorie id=29",
    "Удалено: categorie id=30",
    "Удалено: user id=23",
    "Удалено: user id=24",
    "Удалено: user id=25"
  ],
  "end_ts": "2025-11-09T11:25:52.286961Z"
}